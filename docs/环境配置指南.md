# CodeRetrievr ç¯å¢ƒé…ç½®æŒ‡å—

## 1. ç³»ç»Ÿè¦æ±‚

### 1.1 æ“ä½œç³»ç»Ÿ
- Windows 10/11
- macOS 10.15+
- Linux (Ubuntu 20.04+, CentOS 7+)

### 1.2 è½¯ä»¶ä¾èµ–
- Python 3.9 æˆ–æ›´é«˜ç‰ˆæœ¬
- Docker Desktop 4.0+ (ç”¨äºæœ¬åœ°æ•°æ®åº“éƒ¨ç½²)
- Docker Compose 2.0+
- Git 2.30+

### 1.3 ç¡¬ä»¶è¦æ±‚ï¼ˆæœ¬åœ°å¼€å‘ï¼‰
- CPU: 4æ ¸å¿ƒä»¥ä¸Š
- å†…å­˜: 8GBä»¥ä¸Šï¼ˆæ¨è16GBï¼‰
- ç£ç›˜: 20GBå¯ç”¨ç©ºé—´
- GPU: å¯é€‰ï¼ˆç”¨äºåŠ é€Ÿæ¨¡å‹æ¨ç†ï¼‰

## 2. Pythonç¯å¢ƒé…ç½®

> ğŸ’¡ **æç¤º**ï¼šå¦‚æœä½ ä½¿ç”¨Anacondaï¼Œè¯·å‚è€ƒ [Anacondaç¯å¢ƒé…ç½®æŒ‡å—.md](./Anacondaç¯å¢ƒé…ç½®æŒ‡å—.md) è·å–æ›´è¯¦ç»†çš„condaç¯å¢ƒé…ç½®è¯´æ˜ã€‚

### 2.1 åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ

#### æ–¹æ¡ˆAï¼šä½¿ç”¨Anacondaï¼ˆæ¨èï¼‰

**åˆ›å»ºcondaç¯å¢ƒï¼š**
```bash
# åˆ›å»ºPython 3.9ç¯å¢ƒ
conda create -n coderetrievr python=3.9 -y

# æ¿€æ´»ç¯å¢ƒ
conda activate coderetrievr
```

**éªŒè¯condaç¯å¢ƒï¼š**
```bash
# æŸ¥çœ‹å½“å‰ç¯å¢ƒ
conda info --envs

# ç¡®è®¤Pythonç‰ˆæœ¬
python --version  # åº”æ˜¾ç¤º Python 3.9+
```

#### æ–¹æ¡ˆBï¼šä½¿ç”¨æ ‡å‡†venv

**Windows:**
```bash
python -m venv venv
venv\Scripts\activate
```

**macOS/Linux:**
```bash
python3 -m venv venv
source venv/bin/activate
```

### 2.2 å®‰è£…ä¾èµ–

**ä½¿ç”¨condaç¯å¢ƒï¼š**
```bash
# ç¡®ä¿å·²æ¿€æ´»condaç¯å¢ƒ
conda activate coderetrievr

# å‡çº§pip
python -m pip install --upgrade pip

# å®‰è£…é¡¹ç›®ä¾èµ–
pip install -r requirements.txt
```

**ä½¿ç”¨venvç¯å¢ƒï¼š**
```bash
pip install --upgrade pip
pip install -r requirements.txt
```

**æ³¨æ„**ï¼šæŸäº›åŒ…ï¼ˆå¦‚torchï¼‰å¯èƒ½éœ€è¦ä»ç‰¹å®šæºå®‰è£…ï¼š
```bash
# å¦‚æœtorchå®‰è£…å¤±è´¥ï¼Œå¯ä»¥å°è¯•ï¼š
# CPUç‰ˆæœ¬
pip install torch --index-url https://download.pytorch.org/whl/cpu

# æˆ–ä½¿ç”¨condaå®‰è£…torch
conda install pytorch cpuonly -c pytorch
```

### 2.3 éªŒè¯å®‰è£…

```bash
python --version  # åº”æ˜¾ç¤º Python 3.9+
pip list  # æŸ¥çœ‹å·²å®‰è£…çš„åŒ…

# éªŒè¯å…³é”®åŒ…
python -c "import fastapi; print('FastAPI:', fastapi.__version__)"
python -c "import torch; print('PyTorch:', torch.__version__)"
```

## 3. æ•°æ®åº“æœåŠ¡é…ç½®

### 3.1 å¯åŠ¨DockeræœåŠ¡

ç¡®ä¿Docker Desktopæ­£åœ¨è¿è¡Œï¼Œç„¶åæ‰§è¡Œï¼š

```bash
docker-compose up -d
```

è¿™å°†å¯åŠ¨ä»¥ä¸‹æœåŠ¡ï¼š
- Milvus (çŸ¢é‡æ•°æ®åº“): `localhost:19530`
- Neo4j (çŸ¥è¯†å›¾è°±): `localhost:7687`, Webç•Œé¢: `http://localhost:7474`
- etcd (Milvusä¾èµ–)
- MinIO (Milvusä¾èµ–)

### 3.2 éªŒè¯æœåŠ¡çŠ¶æ€

```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker-compose ps

# æ£€æŸ¥Milvuså¥åº·çŠ¶æ€
curl http://localhost:9091/healthz

# æ£€æŸ¥Neo4j
# è®¿é—® http://localhost:7474
# é»˜è®¤ç”¨æˆ·å: neo4j
# é»˜è®¤å¯†ç : your_neo4j_password (åœ¨docker-compose.ymlä¸­è®¾ç½®)
```

### 3.3 åœæ­¢æœåŠ¡

```bash
docker-compose down
```

### 3.4 æ¸…ç†æ•°æ®ï¼ˆè°¨æ…ä½¿ç”¨ï¼‰

```bash
docker-compose down -v  # åˆ é™¤æ‰€æœ‰æ•°æ®å·
```

## 4. ç¯å¢ƒå˜é‡é…ç½®

### 4.1 åˆ›å»ºç¯å¢ƒå˜é‡æ–‡ä»¶

```bash
cp .env.example .env
```

### 4.2 ç¼–è¾‘ .env æ–‡ä»¶

ä½¿ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€ `.env` æ–‡ä»¶ï¼Œå¡«å…¥ä»¥ä¸‹å…³é”®é…ç½®ï¼š

#### å¿…éœ€é…ç½®

1. **Neo4jå¯†ç **
```env
NEO4J_PASSWORD=your_neo4j_password
```
æ³¨æ„ï¼šéœ€ä¸ `docker-compose.yml` ä¸­çš„å¯†ç ä¸€è‡´

2. **å¤§æ¨¡å‹APIå¯†é’¥**ï¼ˆç”¨äºç”Ÿæˆå¤ç”¨è¯´æ˜ï¼‰
   - **DeepSeek API**ï¼ˆæ¨èï¼Œå›½å†…å¯ç”¨ï¼‰
   ```env
   LLM_PROVIDER=deepseek
   LLM_API_KEY=sk-your-deepseek-api-key
   LLM_BASE_URL=https://api.deepseek.com
   LLM_MODEL=deepseek-chat
   ```
   è·å–æ–¹å¼ï¼šè®¿é—® https://platform.deepseek.com/api_keys
   
   - **OpenAI API**ï¼ˆå¤‡é€‰ï¼‰
   ```env
   LLM_PROVIDER=openai
   LLM_API_KEY=sk-your-openai-api-key
   LLM_MODEL=gpt-3.5-turbo
   ```
   è·å–æ–¹å¼ï¼šè®¿é—® https://platform.openai.com/api-keys

3. **GitHub Token**ï¼ˆç”¨äºä»£ç é‡‡é›†ï¼‰
```env
GITHUB_TOKEN=ghp_your_github_token
```
è·å–æ–¹å¼ï¼šGitHub Settings > Developer settings > Personal access tokens

#### å¯é€‰é…ç½®

- **Pineconeé…ç½®**ï¼ˆå¦‚æœä½¿ç”¨äº‘ç«¯çŸ¢é‡æ•°æ®åº“ï¼‰
- **Redisé…ç½®**ï¼ˆå¦‚æœä½¿ç”¨ç¼“å­˜ï¼‰
- **JWTå¯†é’¥**ï¼ˆå¦‚æœå¯ç”¨ç”¨æˆ·è®¤è¯ï¼‰

### 4.3 éªŒè¯é…ç½®

```bash
# æ£€æŸ¥ç¯å¢ƒå˜é‡æ˜¯å¦åŠ è½½
python -c "from dotenv import load_dotenv; load_dotenv(); import os; print('OPENAI_API_KEY:', 'SET' if os.getenv('OPENAI_API_KEY') else 'NOT SET')"
```

## 5. ç¬¬ä¸‰æ–¹æœåŠ¡ç”³è¯·

### 5.1 GitHub API Token

1. è®¿é—® https://github.com/settings/tokens
2. ç‚¹å‡» "Generate new token (classic)"
3. è®¾ç½®æƒé™ï¼š
   - `public_repo` (è¯»å–å…¬å¼€ä»“åº“)
   - `read:org` (å¦‚æœéœ€è¦è®¿é—®ç»„ç»‡ä»“åº“)
4. ç”Ÿæˆå¹¶å¤åˆ¶token
5. å°†tokenå¡«å…¥ `.env` æ–‡ä»¶çš„ `GITHUB_TOKEN`

**é™åˆ¶è¯´æ˜**ï¼š
- æœªè®¤è¯ï¼š60è¯·æ±‚/å°æ—¶
- è®¤è¯åï¼š5,000è¯·æ±‚/å°æ—¶

### 5.2 OpenAI API Key

1. è®¿é—® https://platform.openai.com/
2. æ³¨å†Œ/ç™»å½•è´¦å·
3. è¿›å…¥ API Keys é¡µé¢
4. åˆ›å»ºæ–°çš„APIå¯†é’¥
5. å°†å¯†é’¥å¡«å…¥ `.env` æ–‡ä»¶çš„ `OPENAI_API_KEY`

**æˆæœ¬è¯´æ˜**ï¼š
- GPT-3.5-turbo: $0.002/1K tokens
- å»ºè®®è®¾ç½®ä½¿ç”¨é™é¢

### 5.3 Pineconeè´¦å·ï¼ˆå¯é€‰ï¼Œäº‘ç«¯éƒ¨ç½²ï¼‰

1. è®¿é—® https://www.pinecone.io/
2. æ³¨å†Œå…è´¹è´¦å·
3. åˆ›å»ºç´¢å¼•
4. è·å–APIå¯†é’¥
5. å°†é…ç½®å¡«å…¥ `.env` æ–‡ä»¶

**å…è´¹é¢åº¦**ï¼š
- å…è´¹ç‰ˆï¼š1ä¸ªç´¢å¼•ï¼Œ100Kå‘é‡

## 6. é¡¹ç›®ç›®å½•ç»“æ„

ç¡®ä¿é¡¹ç›®ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š

```
CodeRetrievr/
â”œâ”€â”€ app/                    # åç«¯åº”ç”¨ä»£ç 
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py            # FastAPIåº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ api/               # APIè·¯ç”±
â”‚   â”œâ”€â”€ core/              # æ ¸å¿ƒé…ç½®
â”‚   â”œâ”€â”€ models/            # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ services/          # ä¸šåŠ¡é€»è¾‘
â”‚   â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
â”œâ”€â”€ frontend/              # å‰ç«¯åº”ç”¨ï¼ˆåç»­åˆ›å»ºï¼‰
â”œâ”€â”€ data/                  # æ•°æ®å­˜å‚¨ç›®å½•
â”‚   â”œâ”€â”€ code_snippets/     # ä»£ç ç‰‡æ®µ
â”‚   â””â”€â”€ metadata/          # å…ƒæ•°æ®
â”œâ”€â”€ docs/                  # æ–‡æ¡£
â”œâ”€â”€ scripts/               # è„šæœ¬å·¥å…·
â”œâ”€â”€ tests/                 # æµ‹è¯•
â”œâ”€â”€ logs/                  # æ—¥å¿—ï¼ˆéœ€åˆ›å»ºï¼‰
â”œâ”€â”€ .env                   # ç¯å¢ƒå˜é‡ï¼ˆéœ€åˆ›å»ºï¼‰
â”œâ”€â”€ .env.example           # ç¯å¢ƒå˜é‡ç¤ºä¾‹
â”œâ”€â”€ docker-compose.yml     # Dockerç¼–æ’
â”œâ”€â”€ requirements.txt       # Pythonä¾èµ–
â””â”€â”€ README.md             # é¡¹ç›®è¯´æ˜
```

åˆ›å»ºå¿…è¦ç›®å½•ï¼š

```bash
mkdir -p app/api app/core app/models app/services app/utils
mkdir -p data/code_snippets data/metadata
mkdir -p scripts tests logs
```

## 7. éªŒè¯ç¯å¢ƒé…ç½®

### 7.1 è¿è¡Œç¯å¢ƒæ£€æŸ¥è„šæœ¬

åˆ›å»º `scripts/check_environment.py`ï¼š

```python
import os
import sys
from dotenv import load_dotenv

load_dotenv()

def check_python():
    version = sys.version_info
    if version.major >= 3 and version.minor >= 9:
        print("âœ… Pythonç‰ˆæœ¬: {}.{}.{}".format(version.major, version.minor, version.micro))
        return True
    else:
        print("âŒ Pythonç‰ˆæœ¬è¿‡ä½ï¼Œéœ€è¦3.9+")
        return False

def check_env_vars():
    required = ['OPENAI_API_KEY', 'GITHUB_TOKEN', 'NEO4J_PASSWORD']
    missing = []
    for var in required:
        if not os.getenv(var):
            missing.append(var)
    
    if missing:
        print(f"âŒ ç¼ºå°‘ç¯å¢ƒå˜é‡: {', '.join(missing)}")
        return False
    else:
        print("âœ… ç¯å¢ƒå˜é‡é…ç½®å®Œæ•´")
        return True

def check_docker():
    import subprocess
    try:
        result = subprocess.run(['docker', '--version'], capture_output=True, text=True)
        if result.returncode == 0:
            print(f"âœ… Dockerå·²å®‰è£…: {result.stdout.strip()}")
            return True
    except:
        pass
    print("âŒ Dockeræœªå®‰è£…æˆ–æœªå¯åŠ¨")
    return False

if __name__ == '__main__':
    print("=" * 50)
    print("ç¯å¢ƒé…ç½®æ£€æŸ¥")
    print("=" * 50)
    
    results = [
        check_python(),
        check_env_vars(),
        check_docker()
    ]
    
    print("=" * 50)
    if all(results):
        print("âœ… ç¯å¢ƒé…ç½®æ£€æŸ¥é€šè¿‡ï¼")
        sys.exit(0)
    else:
        print("âŒ ç¯å¢ƒé…ç½®æ£€æŸ¥å¤±è´¥ï¼Œè¯·ä¿®å¤ä¸Šè¿°é—®é¢˜")
        sys.exit(1)
```

è¿è¡Œæ£€æŸ¥ï¼š

```bash
python scripts/check_environment.py
```

## 8. å¸¸è§é—®é¢˜

### 8.1 DockeræœåŠ¡å¯åŠ¨å¤±è´¥

**é—®é¢˜**ï¼šç«¯å£è¢«å ç”¨

**è§£å†³**ï¼š
```bash
# æ£€æŸ¥ç«¯å£å ç”¨
netstat -ano | findstr :19530  # Windows
lsof -i :19530  # macOS/Linux

# ä¿®æ”¹docker-compose.ymlä¸­çš„ç«¯å£æ˜ å°„
```

### 8.2 Neo4jè¿æ¥å¤±è´¥

**é—®é¢˜**ï¼šå¯†ç ä¸åŒ¹é…

**è§£å†³**ï¼š
1. ç¡®ä¿ `.env` ä¸­çš„ `NEO4J_PASSWORD` ä¸ `docker-compose.yml` ä¸­çš„ä¸€è‡´
2. æˆ–è®¿é—® http://localhost:7474 é‡ç½®å¯†ç 

### 8.3 Pythonä¾èµ–å®‰è£…å¤±è´¥

**é—®é¢˜**ï¼šæŸäº›åŒ…å®‰è£…å¤±è´¥ï¼ˆç‰¹åˆ«æ˜¯torchï¼‰

**è§£å†³**ï¼š
```bash
# ä½¿ç”¨å›½å†…é•œåƒæº
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# æˆ–å•ç‹¬å®‰è£…torch
pip install torch --index-url https://download.pytorch.org/whl/cpu
```

### 8.4 Milvusè¿æ¥è¶…æ—¶

**é—®é¢˜**ï¼šMilvusæœåŠ¡æœªå®Œå…¨å¯åŠ¨

**è§£å†³**ï¼š
```bash
# ç­‰å¾…æœåŠ¡å®Œå…¨å¯åŠ¨ï¼ˆçº¦1-2åˆ†é’Ÿï¼‰
docker-compose logs milvus

# æ£€æŸ¥å¥åº·çŠ¶æ€
curl http://localhost:9091/healthz
```

## 9. ä¸‹ä¸€æ­¥

ç¯å¢ƒé…ç½®å®Œæˆåï¼Œå¯ä»¥ï¼š

1. âœ… éªŒè¯æ‰€æœ‰æœåŠ¡æ­£å¸¸è¿è¡Œ
2. âœ… è¿è¡Œç¯å¢ƒæ£€æŸ¥è„šæœ¬
3. ğŸ“ å¼€å§‹é˜¶æ®µ2ï¼šä»£ç é‡‡é›†ä¸é¢„å¤„ç†

---

**æ–‡æ¡£ç‰ˆæœ¬**ï¼šv1.0  
**åˆ›å»ºæ—¥æœŸ**ï¼š2024å¹´  
**æœ€åæ›´æ–°**ï¼š2024å¹´

