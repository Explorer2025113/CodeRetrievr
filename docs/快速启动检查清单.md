# CodeRetrievr å¿«é€Ÿå¯åŠ¨æ£€æŸ¥æ¸…å•

ä½¿ç”¨æ­¤æ¸…å•å¿«é€Ÿæ£€æŸ¥æ‚¨çš„éƒ¨ç½²çŠ¶æ€ã€‚

## âœ… éƒ¨ç½²å‰æ£€æŸ¥

### 1. ç³»ç»Ÿè½¯ä»¶
- [ ] Python 3.9+ å·²å®‰è£…
  ```bash
  python --version
  ```
- [ ] Docker Desktop å·²å®‰è£…å¹¶è¿è¡Œ
  ```bash
  docker --version
  docker info
  ```
- [ ] Git å·²å®‰è£…
  ```bash
  git --version
  ```

### 2. é¡¹ç›®ä»£ç 
- [ ] é¡¹ç›®å·²å…‹éš†åˆ°æœ¬åœ°
  ```bash
  cd CodeRetrievr
  ls
  ```
- [ ] é¡¹ç›®ç›®å½•ç»“æ„å®Œæ•´
  - [ ] `app/` ç›®å½•å­˜åœ¨
  - [ ] `scripts/` ç›®å½•å­˜åœ¨
  - [ ] `docker-compose.yml` æ–‡ä»¶å­˜åœ¨
  - [ ] `requirements.txt` æ–‡ä»¶å­˜åœ¨

### 3. Python ç¯å¢ƒï¼ˆæ¨èä½¿ç”¨ Anacondaï¼‰
- [ ] Conda ç¯å¢ƒå·²åˆ›å»º
  ```bash
  # åˆ›å»ºç¯å¢ƒ
  conda create -n coderetrievr python=3.9 -y
  
  # æ¿€æ´»ç¯å¢ƒ
  conda activate coderetrievr
  ```
- [ ] Python ä¾èµ–å·²å®‰è£…
  ```bash
  # ç¡®ä¿å·²æ¿€æ´»ç¯å¢ƒ
  conda activate coderetrievr
  
  # æ£€æŸ¥ä¾èµ–
  pip list | grep fastapi
  pip list | grep pymilvus
  ```
- [ ] æˆ–ä½¿ç”¨ venvï¼ˆä¸æ¨èï¼‰
  ```bash
  source venv/bin/activate  # Linux/macOS
  venv\Scripts\activate     # Windows
  ```

### 4. ç¯å¢ƒå˜é‡é…ç½®
- [ ] `.env` æ–‡ä»¶å·²åˆ›å»º
  ```bash
  ls .env
  ```
- [ ] å¿…éœ€ç¯å¢ƒå˜é‡å·²é…ç½®
  - [ ] `LLM_API_KEY` (DeepSeek/OpenAI APIå¯†é’¥)
  - [ ] `GITHUB_TOKEN` (GitHub Token)
  - [ ] `NEO4J_PASSWORD` (Neo4jå¯†ç ï¼Œéœ€ä¸docker-compose.ymlä¸€è‡´)

### 5. Docker æœåŠ¡
- [ ] Docker æœåŠ¡å·²å¯åŠ¨
  ```bash
  docker-compose ps
  ```
- [ ] æ‰€æœ‰æœåŠ¡çŠ¶æ€ä¸º "healthy" æˆ– "Up"
  - [ ] Milvus (code-retrievr-milvus)
  - [ ] Neo4j (code-retrievr-neo4j)
  - [ ] etcd (code-retrievr-etcd)
  - [ ] MinIO (code-retrievr-minio)

## âœ… éªŒè¯æ­¥éª¤

### 1. è¿è¡Œç¯å¢ƒæ£€æŸ¥è„šæœ¬
```bash
python scripts/check_environment.py
```

**æœŸæœ›è¾“å‡º**ï¼š
```
âœ… Pythonç‰ˆæœ¬: 3.9.x
âœ… FastAPI
âœ… PyMilvus
âœ… Neo4j
âœ… ç¯å¢ƒå˜é‡é…ç½®å®Œæ•´
âœ… DockeræœåŠ¡æ­£åœ¨è¿è¡Œ
âœ… MilvusçŸ¢é‡æ•°æ®åº“ (code-retrievr-milvus)
âœ… Neo4jçŸ¥è¯†å›¾è°± (code-retrievr-neo4j)
ğŸ‰ ç¯å¢ƒé…ç½®æ£€æŸ¥å…¨éƒ¨é€šè¿‡ï¼
```

### 2. éªŒè¯ Milvus è¿æ¥
```bash
curl http://localhost:9091/healthz
```

**æœŸæœ›è¾“å‡º**ï¼š`{"status":"ok"}` æˆ– HTTP 200

### 3. éªŒè¯ Neo4j è¿æ¥
```bash
# è®¿é—® http://localhost:7474
# æˆ–ä½¿ç”¨å‘½ä»¤è¡Œ
docker exec code-retrievr-neo4j cypher-shell -u neo4j -p your_actual_password_123 "RETURN 1"
```

**æœŸæœ›è¾“å‡º**ï¼šè¿”å› `1`

### 4. æµ‹è¯•åç«¯æœåŠ¡
```bash
python -m uvicorn app.main:app --reload --host 0.0.0.0 --port 8000
```

**æœŸæœ›è¾“å‡º**ï¼š
```
INFO:     Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
INFO:     Started reloader process
INFO:     Started server process
INFO:     Waiting for application startup.
INFO:     Application startup complete.
```

è®¿é—® http://localhost:8000/docs åº”è¯¥èƒ½çœ‹åˆ° API æ–‡æ¡£ã€‚

## âŒ å¸¸è§é—®é¢˜å¿«é€Ÿè§£å†³

### é—®é¢˜ï¼šDocker æœåŠ¡æœªå¯åŠ¨
```bash
# å¯åŠ¨æ‰€æœ‰æœåŠ¡
docker-compose up -d

# ç­‰å¾…æœåŠ¡å¯åŠ¨ï¼ˆçº¦1-2åˆ†é’Ÿï¼‰
docker-compose ps

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs
```

### é—®é¢˜ï¼šNeo4j è¿æ¥å¤±è´¥
```bash
# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker-compose ps neo4j

# å¦‚æœå®¹å™¨æœªè¿è¡Œï¼Œå¯åŠ¨å®ƒ
docker-compose up -d neo4j

# ç­‰å¾…å®¹å™¨å¯åŠ¨ï¼ˆçº¦30ç§’ï¼‰
docker-compose ps neo4j  # ç­‰å¾…çŠ¶æ€å˜ä¸º "healthy"
```

### é—®é¢˜ï¼šç¯å¢ƒå˜é‡æœªåŠ è½½
```bash
# æ£€æŸ¥ .env æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls .env

# å¦‚æœä¸å­˜åœ¨ï¼Œä»æ¨¡æ¿åˆ›å»º
cp env .env  # Linux/macOS
copy env .env  # Windows

# ç¼–è¾‘ .env æ–‡ä»¶ï¼Œå¡«å…¥å¿…éœ€çš„é…ç½®
```

### é—®é¢˜ï¼šPython ä¾èµ–å®‰è£…å¤±è´¥
```bash
# å‡çº§ pip
python -m pip install --upgrade pip

# ä½¿ç”¨å›½å†…é•œåƒæº
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple

# å•ç‹¬å®‰è£… PyTorchï¼ˆå¦‚æœå¤±è´¥ï¼‰
pip install torch --index-url https://download.pytorch.org/whl/cpu
```

## ğŸš€ ä¸‹ä¸€æ­¥

ç¯å¢ƒé…ç½®å®Œæˆåï¼Œæ‚¨å¯ä»¥ï¼š

1. **é‡‡é›†ä»£ç **ï¼š
   ```bash
   python scripts/collect_code.py tiangolo/fastapi --language python
   ```

2. **å‘é‡åŒ–ä»£ç **ï¼š
   ```bash
   python scripts/vectorize_code.py data/code_snippets/your_file.json
   ```

3. **å¯åŠ¨ API æœåŠ¡**ï¼š
   ```bash
   python -m uvicorn app.main:app --reload
   ```

4. **è®¿é—® API æ–‡æ¡£**ï¼š
   - æ‰“å¼€æµè§ˆå™¨è®¿é—® http://localhost:8000/docs

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [æ–°æœºå™¨éƒ¨ç½²æŒ‡å—](./æ–°æœºå™¨éƒ¨ç½²æŒ‡å—.md) - å®Œæ•´éƒ¨ç½²æ­¥éª¤
- [ç¯å¢ƒé…ç½®æŒ‡å—](./ç¯å¢ƒé…ç½®æŒ‡å—.md) - è¯¦ç»†é…ç½®è¯´æ˜
- [åŠŸèƒ½å®ç°å®Œæˆæ€»ç»“.md](./åŠŸèƒ½å®ç°å®Œæˆæ€»ç»“.md) - é¡¹ç›®åŠŸèƒ½æ€»ç»“
- [é¡¹ç›®åŠŸèƒ½è¯´æ˜.md](./é¡¹ç›®åŠŸèƒ½è¯´æ˜.md) - é¡¹ç›®åŠŸèƒ½è¯´æ˜

---

**æœ€åæ›´æ–°**ï¼š2024å¹´11æœˆ

